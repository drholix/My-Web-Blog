{{ $page := . }}
{{ $coverPath := $page.Params.cover }}
{{ $cover := cond $coverPath ($page.Resources.GetMatch $coverPath) nil }}
{{ if and (not $cover) $coverPath }}
  {{ with resources.Get $coverPath }}{{ $cover = . }}{{ end }}
{{ end }}
{{ $thumbURL := "/images/dashboard-card.svg" }}
{{ $thumbWidth := 120 }}
{{ $thumbHeight := 120 }}
{{ if $cover }}
  {{ if eq (lower $cover.MediaType.Type) "image" }}
    {{ $sub := lower $cover.MediaType.SubType }}
    {{ if or (eq $sub "svg") (eq $sub "svg+xml") }}
      {{ $thumbURL = $cover.RelPermalink }}
      {{ $thumbWidth = 160 }}
      {{ $thumbHeight = 160 }}
    {{ else }}
      {{ with $cover.Fill "320x200 smart" }}
        {{ $thumbURL = .RelPermalink }}
        {{ $thumbWidth = .Width }}
        {{ $thumbHeight = .Height }}
      {{ end }}
    {{ end }}
  {{ end }}
{{ end }}
<article class="post-card">
  <a class="post-card__media" href="{{ $page.RelPermalink }}">
    <img src="{{ $thumbURL }}" width="{{ $thumbWidth }}" height="{{ $thumbHeight }}" alt="{{ $page.Title }} cover" loading="lazy" decoding="async">
  </a>
  <div class="post-card__body">
    <div class="post-card__eyebrow">
      {{ $categories := $page.Params.categories | default (slice) }}
      {{ if gt (len $categories) 0 }}<span>{{ index $categories 0 | humanize }}</span>{{ end }}
      {{ with $page.Date }}<span>{{ .Format "02 Jan 2006" }}</span>{{ end }}
      {{ with $page.ReadingTime }}<span>{{ . }} min read</span>{{ end }}
    </div>
    <h3 class="post-card__title"><a href="{{ $page.RelPermalink }}">{{ $page.Title }}</a></h3>
    {{ with $page.Summary }}<p class="post-card__summary">{{ . | plainify }}</p>{{ end }}
    {{ with $page.Params.tags }}
      <div class="post-card__tags">
        {{ range first 4 . }}<span>#{{ . }}</span>{{ end }}
      </div>
    {{ end }}
  </div>
</article>
